---
import Layout from "../layouts/main.astro";
import PageHeading from "../components/page-heading.astro";
import PostsLoop from "../components/posts-loop.astro";

// 初始 query
let query = '';
---

<Layout title="Search Posts">
  <section class="relative z-20 max-w-2xl mx-auto my-12 px-7 lg:px-0">
    <PageHeading
      title="Search Posts"
      description="Search through my posts by keyword in the title or description."
    />

    <!-- 搜索输入框 -->
    <div class="my-6">
      <input
        type="text"
        placeholder="Type a keyword to search..."
        class="w-full border border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-100"
        id="search-input"
      />
    </div>

    <!-- 搜索结果 -->
    <div class="z-50 flex flex-col items-stretch w-full gap-5 my-8" id="search-results">
      <PostsLoop count="999999" query={query} />
    </div>
  </section>

  <script type="module">
    const input = document.getElementById('search-input');
    input.addEventListener('input', (e) => {
      const value = e.target.value.toLowerCase();
      const url = new URL(window.location.href);
      url.searchParams.set('q', value);
      window.history.replaceState({}, '', url);
      // 更新 query 重新渲染 PostsLoop
      const event = new CustomEvent('search:update', { detail: value });
      document.getElementById('search-results').dispatchEvent(event);
    });
  </script>
</Layout>
